# Day1：タイルマップで動き回る日（7人×3時間用シナリオ）

## 0. 今日のゴール（先生が最初に読む用）

3時間で、次を「クラス全体」として完成させます。

1. CSVタイルマップ上で、プレイヤー矩形が **矢印キー／WASD でスムーズに移動** できる  
2. カメラがプレイヤーを追いかけて、**広いマップを歩き回れる**  
3. コードの中で「入力ベクトル」「速度」「カメラ追従」を自分の言葉で説明できる  

※ Day1時点では **壁すり抜けOK** です。衝突処理は Day2 のテーマにします。

### 絶対ルール

- この日は **移動の気持ちよさとカメラ** に集中する
- 触るファイルは基本的に `main_day1.py` のみ（他ファイルは「読むだけ」はOK）
- 迷ったら先生かこのプリントに必ず戻る

---

## 1. 今日の7人の役割（先に割り当てる）

| No | 役割名                       | 触るファイル      | ざっくりやること                                      |
|----|------------------------------|-------------------|-------------------------------------------------------|
| A  | プロジェクト起動担当         | `main_day1.py`    | Kivyゲームを起動できるようにする                      |
| B  | マップ＆カメラ担当           | `main_day1.py`    | タイルマップの読み込みと、カメラ追従の調整            |
| C  | 入力ベクトル＆スピード担当   | `main_day1.py`    | 矢印/WASD入力から移動方向ベクトルと速度を作る        |
| D  | プレイヤー座標＆Clamp担当    | `main_day1.py`    | px/py の更新と、マップ端で外に出ないようClampする     |
| E  | HUDメッセージ＆TODO担当      | `main_day1.py`    | 画面上の説明文（HUD）と、実装済みTODOの表示           |
| F  | 掃除＆コメント担当           | `main_day1.py`    | 変数名・コメントを整えて読みやすくする                |
| G  | テスト＆バグログ担当         | `docs/Day1_buglog.md` | 動作確認とバグ／改善アイデアの記録               |

> 先生へ：  
> 役割は途中で交代しても構いません。  
> 「A：環境準備／B〜E：動きと見た目／F：リファクタ／G：記録」というイメージです。

---

## 2. 今日の時間割（板書用）

- 0:00〜0:10　ゲーム内容の紹介＆Day1のゴール共有
- 0:10〜0:25　環境チェック（Python／Kivy が動くか確認）
- 0:25〜1:10　**個人作業タイム**（A〜Eの担当ごとにコーディング）
- 1:10〜1:40　コードの共有・Fによる「読みやすさチェック」
- 1:40〜2:20　G主導でテスト＆バグログ作成
- 2:20〜3:00　今日のふりかえり＆Day2へのつながり確認

---

## 3. 各役割の「やることチェックリスト」

### 3-1. A：プロジェクト起動担当

**目的**：全員が `python main_day1.py` でゲームを起動できるようにする。

#### チェックリスト

- [ ] ターミナル（またはVSCodeのターミナル）を開いた
- [ ] プロジェクトフォルダに移動した（`cd Vinegar-Kelp_RPG-main`）
- [ ] 必要なら `pip install kivy kivymd` を実行した
- [ ] `python main_day1.py` でウィンドウが開くことを確認した
- [ ] うまくいかなかった人のエラーを、先生と一緒に読んでサポートした

---

### 3-2. B：マップ＆カメラ担当

**目的**：CSVからタイルマップを読み込み、プレイヤーを中心にカメラが追いかけるようにする。

#### チェックリスト

- [ ] `load_csv_as_tilemap` と `load_tileset_regions` が何を返しているかを確認した
- [ ] `self.grid`, `self.rows`, `self.cols`, `self.tiles` の意味を理解した
- [ ] `self.cam[0]` / `self.cam[1]` によるカメラ追従の処理を確認した
- [ ] プレイヤーがマップの端付近に行ったときも、画面が真っ黒にならないようにした

#### サンプルコード（イメージ）

```python
class Game(Widget):
    cam = ListProperty([0, 0])

    def __init__(self, **kw):
        super().__init__(**kw)
        self.size = (WIDTH, HEIGHT)
        self.grid, self.rows, self.cols = load_csv_as_tilemap(MAP_CSV)
        self.tiles = load_tileset_regions()
        # プレイヤ初期位置
        self.px = TILE_SIZE * 2
        self.py = TILE_SIZE * 2
        self.cam = [0, 0]
```

カメラ追従の部分：

```python
        self.cam[0] = max(0, self.px - self.width / 2)
        self.cam[1] = max(0, self.py - self.height / 2)
```

> ✅ Bさんは「**世界とカメラ係**」です。  
> プレイヤがマップのどこにいても、ちゃんと背景が描画されるように注意しましょう。

---

### 3-3. C：入力ベクトル＆スピード担当

**目的**：矢印キー／WASD から移動方向ベクトルを作り、スピードに反映する。

#### チェックリスト

- [ ] 左右・上下のキーコード（276/275/273/274）を確認した
- [ ] `ax`, `ay` を「右なら+1、左なら-1」などの形で計算している
- [ ] `PLAYER_SPEED` を使って、`vx`, `vy` を求めている
- [ ] 余裕があれば、Shiftキー（303/304）で `RUN_MULTIPLIER` を使う実装案を考えた
- [ ] さらに余裕があれば、`ACCEL` と `FRICTION` を使った慣性の実装案を考えた

#### サンプルコード（現在の骨組み）

```python
    def update(self, dt):
        import math
        left=276; right=275; up=273; down=274
        ax = (1 if right in self.keys else 0) - (1 if left in self.keys else 0)
        ay = (1 if down in self.keys else 0) - (1 if up in self.keys else 0)

        speed = PLAYER_SPEED

        # TODO: 走る（Shift）
        # if 304 in self.keys or 303 in self.keys:
        #     speed *= RUN_MULTIPLIER

        # TODO: 慣性＋摩擦
        # self.vx = self.vx*(1-ACCEL) + ax*speed*ACCEL
        # self.vy = self.vy*(1-ACCEL) + ay*speed*ACCEL
        # self.vx *= FRICTION
        # self.vy *= FRICTION

        self.vx = ax*speed
        self.vy = ay*speed
```

> ✅ Cさんは「**操作感担当**」です。  
> 走る・滑る・止まるの感覚をどうするか、Gさんに感想を聞きながら調整案をメモしましょう。

---

### 3-4. D：プレイヤー座標＆Clamp担当

**目的**：`px`, `py` を更新し、マップ外にはみ出さないようにする。

#### チェックリスト

- [ ] `self.px += self.vx; self.py += self.vy` で座標を更新している
- [ ] Clamp（マップ端）のTODOコメントを見つけた
- [ ] `px` / `py` が 0 未満にならないようにした
- [ ] マップの右端・下端を計算して、その外に出ないようにした

#### サンプルコード（イメージ）

```python
        self.px += self.vx
        self.py += self.vy

        # TODO: Clamp（マップ端）
        max_x = self.cols * TILE_SIZE - (TILE_SIZE - 6)
        max_y = self.rows * TILE_SIZE - (TILE_SIZE - 6)
        self.px = max(0, min(self.px, max_x))
        self.py = max(0, min(self.py, max_y))
```

> ✅ Dさんは「**安全運転係**」です。  
> 画面外に飛び出したり、見えない場所に行ってしまわないように守ってあげましょう。

---

### 3-5. E：HUDメッセージ＆TODO担当

**目的**：画面上部のHUDテキストを使って、操作説明やTODOの状態を分かりやすくする。

#### チェックリスト

- [ ] `self.hud = Label(...)` を見つけて、テキスト内容を確認した
- [ ] 「矢印/WASDで移動」「Shiftで走る（未実装）」など、操作説明をHUDに書いた
- [ ] TODOが1つでも実装できたら、その情報もHUDに表示するようにした

#### サンプルコード（イメージ）

```python
        done_flags = []
        # 例: 走るが実装できたら
        # done_flags.append("Shift走るOK")

        status = " / ".join(done_flags) if done_flags else "TODO: 走る/慣性/摩擦/Clamp"
        self.hud.text = f"矢印/WASDで移動 — {status}"
```

> ✅ Eさんは「**画面の案内係**」です。  
> プレイヤーが何をすればいいか、パッと見て分かるテキストを工夫してみてください。

---

### 3-6. F：掃除＆コメント担当

**目的**：他の人が書いたコードを読みやすく整え、「Day1完成版」として仕上げる。

#### チェックリスト

- [ ] 使っていない変数や `print` を見つけて、消すかコメントにした
- [ ] 同じ意味の数字（マジックナンバー）を、`config.py` の定数に置き換えた
- [ ] 「ここでなにをしているか」が分かるコメントを1〜2行ずつ追加した

> ✅ Fさんは「**リーダブルコード係**」です。  
> 「初めてこのファイルを開いた人」が理解しやすいように直すのが仕事です。

---

### 3-7. G：テスト＆バグログ担当

**目的**：今日作った Day1 のゲームを実際に遊んでみて、バグや改善アイデアをメモする。

- 触るファイル：`docs/Day1_buglog.md`（新規作成）

#### チェックリスト

- [ ] 少なくとも3回以上プレイしてみた
- [ ] 「速すぎる／遅すぎる」「カメラ酔いしそう」などの感想をチームに共有した
- [ ] 気になった点を1件ずつ文章にして書いた

#### バグログテンプレ

```text
【2025-xx-xx Day1 バグログ】

■バグ1：マップの外に出てしまう
内容：
    右端にずっと歩いていくと、背景が真っ黒になってしまう。
原因（予想）：
    Clampのmax_xがcols*TILE_SIZEより大きくなっている。
対応：
    max_xの計算を見直し、プレイヤの幅も考慮した。

■改善アイデア1：開始時に操作説明を少し長く出したい
内容：
    ゲーム開始直後にだけ、操作説明を大きく表示したい。
メモ：
    数秒後に消えるテキストを追加する、など。
```

---

## 4. 全員共通のNGリスト

- 他の人の担当部分を勝手に削除しない（修正したいときは必ず相談する）
- エラーが出たときに、**黙ってコードを消してしまわない**
- `main_day1.py` をコピーして別ファイル名にする場合、どれが最新か分からなくならないようにする

---

## 5. 今日のまとめメモ欄（クラス用）

- 今日できたこと：

- 次にやりたいこと（Day2 への発展案など）：
